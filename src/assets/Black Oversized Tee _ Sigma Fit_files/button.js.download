const peppyButtonFunction=async()=>{if(document.querySelector(".peppy-form-container").style.setProperty("display","none","important"),"product"!==peppyPageType)return;(async()=>{const e=new URLSearchParams(window.location.search).get("pdSId");if(!e)return;(e=>{const t={product_id:peppyProductId,product_variant_id:peppySelectedOrFirstAvailableVariant.id,pdSId:e},p={method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json","shop-id":peppyShopId}};fetch("/apps/back-in-stock/trackClick",p)})(e),((e,t,p)=>{let o="";if(p){let e=new Date;e.setTime(e.getTime()+24*p*60*60*1e3),o="; expires="+e.toGMTString()}document.cookie=e+"="+t+o+"; path=/"})("pdSId",e,30)})();let e,t;const p=(async()=>{const e={method:"GET",headers:{"shop-id":peppyShopId}},t=await fetch("/apps/back-in-stock/fetchStoreFrontUiConfig?"+new URLSearchParams({locale:window.Shopify.locale}),e);return await t.json()})(),o=e=>{const t=new URLSearchParams(window.location.search).get("variant");let p;if(t)return p=peppyVariantList.find((e=>e.id===Number(t))),p;let o=e.target;return o.value?p?void 0:(p=peppyVariantList.find((e=>e.title===o.value)),p):void 0},n=document.querySelector(".peppy-notify-me-button-wrapper"),r=document.querySelector(".peppy-popup-form-wrapper"),i=(e,t,p)=>{if(null===e.inventory_management)return!1;if(!((e,t=0)=>peppyVariantInventoryDetailsMap[e.id].inventory_quantity-t<=0)(e,t))return!1;return"continue"!==peppyVariantInventoryDetailsMap[e.id].inventory_policy||p},s=(e,p,o)=>p&&t||i(peppySelectedOrFirstAvailableVariant,e,o),a=t=>{setTimeout((()=>{const p=o(t);p&&(i(p,e.DISPLAY_INVENTORY_THRESHOLD,e.SHOW_IF_CONTINUE_SELLING_POLICY_AND_OOS)?n.showButton():n.hideButton())}),10)};(async()=>{const o=await p;Boolean(o.bis_enabled)&&(e=o.ui_config.BUTTON_CONFIG,n.processProductTags(e.TAGS_CONFIGURATION),n.ignoreProduct?console.log("product ignored"):(e.SHOW_IF_ANY_VARIANT_OOS&&(t=((e,t)=>{for(const p of peppyVariantList)if(i(p,e,t))return p;return null})(e.DISPLAY_INVENTORY_THRESHOLD,e.SHOW_IF_CONTINUE_SELLING_POLICY_AND_OOS)),n.setButtonUiConfig(e),n.setCustomButtonStyling(),r.populateOosVariants(e),r.setPopupFormUiConfig(o.ui_config.POPUP_FORM_CONFIG,o.bis_channels_config,o.shopify_store_name),s(e.DISPLAY_INVENTORY_THRESHOLD,e.SHOW_IF_ANY_VARIANT_OOS,e.SHOW_IF_CONTINUE_SELLING_POLICY_AND_OOS)&&n.showButton(),window.addEventListener("click",(e=>{a(e)})),45175701665===peppyShopId?window.addEventListener("touchstart",(e=>{a(e)})):72113783094===peppyShopId||72872296731===peppyShopId||21193793===peppyShopId||38413107337===peppyShopId||70507757821===peppyShopId||89351717183===peppyShopId||70002049292===peppyShopId||70791430365===peppyShopId||61102293057===peppyShopId||84954710343===peppyShopId?window.addEventListener("change",(e=>{a(e)})):67679355118===peppyShopId?document.querySelector(".variant-input-wrap").addEventListener("change",(e=>{a(e)})):69011243322===peppyShopId&&document.querySelector(".gf_variants.single-option-selector.single-option-selector-product").addEventListener("change",(e=>{a(e)})),console.log("peppy button configured")))})();const l=async e=>{const t=new Date,p=Number(r.querySelector(".oos-variants").value),o={product_id:peppyProductId,product_variant_id:p,subscription_start_date_time:t,bis_channel:e,country:window.Shopify.country,locale:window.Shopify.locale};switch(e){case"email":{const[e,t]=await(async()=>{let e=r.querySelector(".peppy-popup-form-email-field").value;return/\S+@\S+\.\S+/.test(e)?[!0,e]:[!1,""]})();if(!e)return void r.errorMessage(r.invalidEmailError);o.customer_email_address=t;break}case"wa":{const e=r.querySelector(".peppy-popup-form-countrycode-dropdown"),[t,p]=await(async()=>{let e=r.querySelector(".peppy-popup-form-number-field").value;return/^[- ()]*[0-9][- ()0-9]*$/.test(e)?(e=await(async e=>e.replace(/[- )(]/g,""))(e),[!0,e]):[!1,""]})();if(!t)return void r.errorMessage(r.invalidNumberError);o.customer_phone_number="+"+e.value+"-"+p;break}}(async e=>{r.handleFormButtonAction("disable");const t={method:"POST",body:JSON.stringify(e),headers:{"shop-id":peppyShopId,"Content-Type":"application/json"}};try{const e="/apps/back-in-stock/createSubscriptionTableEntry",p=await fetch(e,t);r.handleFormButtonAction("enable"),!0===(await p.json()).success?r.successMessage():r.errorMessage(r.errorMessageText)}catch{r.errorMessage(r.errorMessageText)}})(o)},c=(e,t,p)=>{p&&e.style.setProperty(t,p,"important")},d=e=>{n.parentElement.style.setProperty("display",e,"important")},y=()=>{const e=n.parentElement;d("block"),e.classList.add("peppy-notify-me-button-container-float-right")},u=()=>!!(n.offsetWidth||n.offsetHeight||n.getClientRects().length)&&"hidden"!==window.getComputedStyle(n).visibility,h=()=>{const e=n.parentElement,t=document.querySelectorAll('form[action*="/cart/add"]');for(const p of t){if(p.appendChild(e),d("block"),u())return;d("none")}y()};class m extends HTMLElement{constructor(){super(),this.retryCount=0,this.cssProperties=document.querySelector(":root"),this.peppyButton=this.querySelector(".peppy-notify-me-button"),this.onClick(),this.ignoreProduct=!1}processProductTags(e){for(const t of peppyProductTags)("hide-notify-me-peppyduck"===t||e?.HIDE_BUTTON?.TAGS?.includes(t))&&(this.ignoreProduct=!0)}onClick(){this.parentElement.addEventListener("click",(e=>{if(1!==peppyVariantList.length){const t=o(e);t&&r.setSelectedOosVariant(t)}r.setupModal(),r.parentElement.showModal(),r.parentElement.style.setProperty("display","block","important"),r.querySelector(".peppy-popup-form-notifyme-button").style.setProperty("display","block")}))}showButton(){this.insertButton()}setCustomButtonStyling(){if(87745495349===peppyShopId){window.matchMedia("(min-width: 641px)").matches?c(this.parentElement,"width","calc(50% - 18px)"):c(this.parentElement,"width","100%")}else if(18732567===peppyShopId){window.matchMedia("(min-width: 750px)").matches?c(this.parentElement,"width","300px"):c(this.parentElement,"width","100%")}else if(12702580836===peppyShopId){window.matchMedia("(min-width: 740px)").matches?c(this.parentElement,"width","280px"):c(this.parentElement,"width","100%")}else if(54517366965===peppyShopId){let e=[];e.push(window.matchMedia("(min-width: 1425px)")),e.push(window.matchMedia("(min-width: 1200px)")),e.push(window.matchMedia("(min-width: 992px)")),e.push(window.matchMedia("(min-width: 767px)")),e.push(window.matchMedia("(min-width: 550px)")),e[0].matches?(c(this.parentElement,"width","387px"),c(this.parentElement,"margin-top","-12px")):e[1].matches?(c(this.parentElement,"width","340px"),c(this.parentElement,"margin-top","-12px")):e[2].matches?(c(this.parentElement,"width","258px"),c(this.parentElement,"margin-top","-12px")):e[3].matches?(c(this.parentElement,"width","390px"),c(this.parentElement,"margin-top","-12px")):e[4].matches?c(this.parentElement,"width","calc(70% + 20px)"):c(this.parentElement,"width","100%")}else if(60659433703===peppyShopId){window.matchMedia("(min-width: 641px)").matches&&(c(this.parentElement,"width","calc(50% - 18px)"),c(this.parentElement,"margin-top","9px"))}else if(57794953373===peppyShopId){window.matchMedia("(min-width: 769px)").matches&&(c(this.parentElement,"width","300px"),c(this.peppyButton,"height","64px"))}}setButtonUiConfig(e){this.peppyButton.textContent=e.BUTTON_TEXT,c(this,"--peppy-notifyme-button-background-color",e.BACKGROUND_COLOR),c(this,"--peppy-notifyme-button-text-color",e.COLOR_OF_TEXT);c(this.parentElement,"z-index",e.Z_INDEX),c(this.peppyButton,"border-radius",e.BORDER_RADIUS),c(this.peppyButton,"line-height",e.LINE_HEIGHT),c(this.peppyButton,"box-shadow",e.BOX_SHADOW),(()=>{e.FONT&&(c(this.peppyButton,"font-weight",e.FONT.WEIGHT),c(this.peppyButton,"font-size",e.FONT.SIZE),c(this.peppyButton,"font-style",e.FONT.STYLE),c(this.peppyButton,"font-family",e.FONT.FAMILY),c(this.peppyButton,"letter-spacing",e.FONT.LETTER_SPACING))})(),(()=>{e.PADDING&&(c(this.peppyButton,"padding-top",e.PADDING.TOP),c(this.peppyButton,"padding-bottom",e.PADDING.BOTTOM),c(this.peppyButton,"padding-left",e.PADDING.LEFT),c(this.peppyButton,"padding-right",e.PADDING.RIGHT))})(),(()=>{e.MARGIN&&(c(this.parentElement,"margin-top",e.MARGIN.TOP),c(this.parentElement,"margin-bottom",e.MARGIN.BOTTOM),c(this.parentElement,"margin-left",e.MARGIN.LEFT),c(this.parentElement,"margin-right",e.MARGIN.RIGHT))})(),(()=>{e.DIMENSIONS&&(c(this.parentElement,"width",e.DIMENSIONS.WIDTH),c(this.peppyButton,"height",e.DIMENSIONS.HEIGHT))})(),e.OTHERS&&e.OTHERS.forEach((e=>{c(document.querySelector(e.TARGET),e.PROPERTY,e.PROPERTY_VALUE)}))}insertButton(){if("float-right"===e.INSERT_PARAMS.METHOD)return y(),void(e.INSERT_PARAMS.HEIGHT_FROM_TOP&&c(n.parentElement,"top",e.INSERT_PARAMS.HEIGHT_FROM_TOP));const t=document.querySelector(e.INSERT_PARAMS.SELECTOR);if(!t)return void h();"after"===e.INSERT_PARAMS.METHOD?t.after(n.parentElement):"before"===e.INSERT_PARAMS.METHOD?t.parentElement.insertBefore(n.parentElement,t):"append-child"===e.INSERT_PARAMS.METHOD?t.appendChild(n.parentElement):console.log("Unknown insertion method."),d("block");setTimeout((()=>{let e=document.querySelector(".peppy-notify-me-button-container");2===this.retryCount?console.log("error adding button"):e||(d("none"),this.insertButton(),this.retryCount++,console.log(`retrying inserting button for shop: ${peppyShopId}`))}),900),u()||(d("none"),h())}hideButton(){e.SHOW_IF_ANY_VARIANT_OOS||(d("none"),this.retryCount=0)}}customElements.get("peppy-button")||customElements.define("peppy-button",m);class S extends HTMLElement{constructor(){super(),this.retryCount=0,this.successMessageText,this.errorMessageText,this.invalidEmailError,this.invalidNumberError,this.selectedChannel,this.setSelectedProduct(),this.notifyMeButtonClick(),this.bisChannelToggle(),this.closeButtonClick(),this.cssProperties=document.querySelector(":root"),this.insertDialog()}insertDialog=()=>{if(52941258945===peppyShopId||4383440945===peppyShopId||66787377316===peppyShopId){const e=document.querySelector(".peppy-form-container");document.querySelector("body").appendChild(e.parentElement)}};setChannelsConfig=(e,t)=>{const p=(t,p)=>{switch(p){case"email":t.labels[0].textContent=e.EMAIL_CHANNEL_LABEL;break;case"wa":t.labels[0].textContent=e.WHATSAPP_CHANNEL_LABEL}},o=this.querySelector(".peppy-popup-form-bis-default-channel"),n=this.querySelector(".peppy-popup-form-bis-second-channel"),r=t.DEFAULT_CHANNEL,i=t.SECOND_CHANNEL;o.value=r,n.value=i,this.selectedChannel=r,(e=>{switch(e){case"email":c(document.querySelector(".peppy-phone-number-div"),"display","none");break;case"wa":c(document.querySelector(".peppy-email-address-div"),"display","none")}})(r),p(o,r),i?p(n,i):c(document.querySelector(".peppy-popup-form-bis-channels-div"),"display","none")};setPopupFormUiConfig(e,t,p){this.querySelector(".peppy-popup-form-title").textContent=e.TITLE,this.querySelector(".peppy-popup-form-headline").textContent=e.HEADLINE,this.querySelector(".peppy-popup-form-notifyme-button").textContent=e.BUTTON_TEXT,this.querySelector(".peppy-popup-form-tos-text").textContent=e.TERMS_OF_SERVICE_TEXT,this.querySelector(".peppy-popup-form-email-field").setAttribute("placeholder",e.EMAIL_PLACEHOLDER_TEXT),this.querySelector(".peppy-popup-form-number-field").setAttribute("placeholder",e.NUMBER_PLACEHOLDER);const o=e.DEFAULT_COUNTRY_SELECTED;this.querySelector(".peppy-popup-form-countrycode-dropdown").value=o.startsWith("+")?o.substring(1):o,this.cssProperties.style.setProperty("--peppy-popup-form-notifyme-button-background-color",e.BACKGROUND_COLOR),this.cssProperties.style.setProperty("--peppy-popup-form-notifyme-button-text-color",e.COLOR_OF_TEXT),this.successMessageText=e.SUCCESS_MESSAGE,this.errorMessageText=e.ERROR_MESSAGE,this.invalidEmailError=e.INVALID_EMAIL_ERROR_MESSAGE,this.invalidNumberError=e.ERROR_MESSAGE_INVALID_PHONE_NUMBER,this.setPeppyDuckBranding(e.BRANDING,p),this.setChannelsConfig(e,t);e.OTHERS&&e.OTHERS.forEach((e=>{c(document.querySelector(e.TARGET),e.PROPERTY,e.PROPERTY_VALUE)})),c(this.querySelector(".peppy-popup-form-notifyme-button"),"border-radius",e.BORDER_RADIUS),(()=>{e.FONT&&(c(this.querySelector(".peppy-popup-form"),"font-style",e.FONT.STYLE),c(this.querySelector(".peppy-popup-form"),"font-family",e.FONT.FAMILY),c(this.querySelector(".peppy-popup-form-notifyme-button"),"font-style",e.FONT.STYLE),c(this.querySelector(".peppy-popup-form-notifyme-button"),"font-family",e.FONT.FAMILY),c(this.querySelector(".peppy-popup-form-notifyme-button"),"font-weight",e.FONT.WEIGHT),c(this.querySelector(".peppy-popup-form-notifyme-button"),"font-size",e.FONT.SIZE),c(this.querySelector(".peppy-popup-form-notifyme-button"),"letter-spacing",e.FONT.LETTER_SPACING))})()}setPeppyDuckBranding(e,t){const p=(()=>{try{return(0==window.screen.orientation.angle||180===window.screen.orientation.angle?window.outerWidth>window.outerHeight:90===window.screen.orientation.angle||270===window.screen.orientation.angle?window.outerWidth<window.outerHeight:void 0)?"desktop":"mobile"}catch(e){return"mobile"}})();(!e||"desktop"===p&&e.DESKTOP||"mobile"===p&&e.MOBILE)&&(()=>{const e=document.querySelector(".peppy-popup-form-branding");if(e.children.length>=2)return;e.querySelector(".peppy-popup-form-branding-prefix").textContent="Powered by";const p=document.createElement("a"),o=document.createTextNode("Peppyduck");var n;p.appendChild(o),p.title="Peppyduck",p.target="_blank",p.style.setProperty("font-size","16px","important"),p.style.setProperty("color","rgb(51, 51, 51)","important"),p.style.setProperty("text-decoration","underline","important"),p.href=`https://apps.shopify.com/back-in-stock-whatsapp-alerts?utm_source=notifymepopup&utm_medium=web&utm_campaign=${n=t,n.replace(".myshopify.com","")}`,e.appendChild(p),e.style.setProperty("display","block","important")})()}setSelectedProduct(){this.querySelector(".peppy-popup-form-selected-product").textContent=peppyProductName}populateOosVariants(e){const t=this.querySelector(".oos-variants");t.innerHTML="",peppySelectedOrFirstAvailableVariant?setTimeout((()=>{this.setSelectedOosVariant(peppySelectedOrFirstAvailableVariant)}),10):s(e.DISPLAY_INVENTORY_THRESHOLD,e.SHOW_IF_ANY_VARIANT_OOS,e.SHOW_IF_CONTINUE_SELLING_POLICY_AND_OOS)&&this.setSelectedOosVariant(peppyVariantList[0]);for(let p=0;p<peppyVariantList.length;p++){if(!i(peppyVariantList[p],e.DISPLAY_INVENTORY_THRESHOLD,e.SHOW_IF_CONTINUE_SELLING_POLICY_AND_OOS))continue;const o=document.createElement("option");o.text=peppyVariantList[p].title,o.value=peppyVariantList[p].id,t.add(o,t[p])}if(1===peppyVariantList.length){this.querySelector(".oos-variants-div").style.setProperty("display","none"),this.selectedVariant=peppyVariantList[0]}}setSelectedOosVariant(p){e.SHOW_IF_ANY_VARIANT_OOS&&(p=i(p,e.DISPLAY_INVENTORY_THRESHOLD,e.SHOW_IF_CONTINUE_SELLING_POLICY_AND_OOS)?p:t);this.querySelector(".oos-variants").value=p.id}setupModal(){this.querySelector(".peppy-popup-form-notifyme-button").style.setProperty("display","block","important"),this.querySelector(".peppy-popup-form-tos-text-container").style.setProperty("display","block","important"),this.querySelector(".peppy-popup-form-success-message-div").style.setProperty("display","none","important"),this.querySelector(".peppy-popup-form-error-message-div").style.setProperty("display","none","important")}bisChannelToggle(){this.querySelector(".peppy-popup-form-bis-channels-div").addEventListener("click",(e=>{if(".peppy-popup-form-bis-default-channel"!==e.target.className&&".peppy-popup-form-bis-second-channel"===e.target.className)return;this.setupModal();const t=this.querySelector('input[name="bis-channel"]:checked').value;switch(this.selectedChannel=t,t){case"email":c(document.querySelector(".peppy-phone-number-div"),"display","none"),c(document.querySelector(".peppy-email-address-div"),"display","flex");break;case"wa":c(document.querySelector(".peppy-email-address-div"),"display","none"),c(document.querySelector(".peppy-phone-number-div"),"display","flex")}}))}notifyMeButtonClick(){this.querySelector(".peppy-popup-form-notifyme-button").addEventListener("click",(()=>{l(this.selectedChannel)}))}handleFormButtonAction(e){const t=this.querySelector("#peppy-form-submit");switch(e){case"enable":t.classList.remove("peppy-form-btn-disabled");break;case"disable":t.classList.add("peppy-form-btn-disabled")}}successMessage(){const e=this.querySelector(".peppy-popup-form-success-message-div");this.querySelector(".peppy-popup-form-notifyme-button").style.setProperty("display","none","important"),e.textContent=this.successMessageText,e.style.setProperty("color","green"),e.style.setProperty("display","block","important"),this.querySelector(".peppy-popup-form-tos-text-container").style.setProperty("display","none","important"),this.querySelector(".peppy-popup-form-error-message-div").style.setProperty("display","none","important")}errorMessage(e){const t=this.querySelector(".peppy-popup-form-error-message-div");t.textContent=e,t.style.setProperty("color","red"),t.style.setProperty("display","block","important")}closeButtonClick(){this.querySelector("#close-btn").addEventListener("click",(()=>{r.parentElement.style.setProperty("display","none","important"),this.parentElement.close()}))}}customElements.get("peppy-form")||customElements.define("peppy-form",S)};peppyButtonFunction();